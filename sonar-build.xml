
<!-- 
After executing "test-run" target in mirth-build.xml, run SonarQube analysis with the following command: 
ant -buildfile sonar-build.xml -Dsonar.host.url="<sonarqube-server-url>" -Dsonar.login="<auth token>" sonar 
-->
<project name="mirth-connect" basedir="." default="build" xmlns:sonar="antlib:org.sonar.ant">

	<!-- Define the SonarQube project properties -->
	<property name="sonar.projectKey" value="MC_Pilot" />
	<property name="sonar.projectName" value="Mirth Connect" />
	<property name="sonar.projectVersion" value="1.0" />
	<property name="sonar.language" value="java" />
	<property name="sonar.dynamicAnalysis" value="reuseReports" />
	<property name="sonar.java.coveragePlugin" value="jacoco" />
	
	<property name="sonar.modules" value="client,command,donkey,generator,manager,server,simplesender,webadmin"/>

	<property name="client.sonar.projectKey" value="com.mirth.connect.client" />
	<property name="client.sonar.projectName" value="Client" />
	<property name="client.sonar.sources" value="src" />
	<property name="client.sonar.tests" value="test" />
	<property name="client.sonar.java.binaries" value="classes" />
	<property name="client.sonar.java.libraries" value="lib/*.jar" />
	<property name="client.sonar.projectBaseDir" value="client" />
	<property name="client.sonar.junit.reportsPath" value="junit-reports" />
	<property name="client.sonar.jacoco.reportPath" value="code-coverage-reports/jacoco.exec" />

	<property name="command.sonar.projectKey" value="com.mirth.connect.cli" />
	<property name="command.sonar.projectName" value="CLI" />
	<property name="command.sonar.sources" value="src" />
	<property name="command.sonar.tests" value="test" />
	<property name="command.sonar.java.binaries" value="classes" />
	<property name="command.sonar.java.libraries" value="lib/*.jar" />
	<property name="command.sonar.projectBaseDir" value="command" />
	<property name="command.sonar.junit.reportsPath" value="junit-reports" />
	<property name="command.sonar.jacoco.reportPath" value="code-coverage-reports/jacoco.exec" />

	<property name="donkey.sonar.projectKey" value="com.mirth.connect.donkey" />
	<property name="donkey.sonar.projectName" value="Donkey" />
	<property name="donkey.sonar.sources" value="src/main/java" />
	<property name="donkey.sonar.tests" value="src/test/java" />
	<property name="donkey.sonar.java.binaries" value="classes" />
	<property name="donkey.sonar.java.libraries" value="lib/*.jar" />
	<property name="donkey.sonar.projectBaseDir" value="donkey" />
	<property name="donkey.sonar.junit.reportsPath" value="junit-reports" />
	<property name="donkey.sonar.jacoco.reportPath" value="code-coverage-reports/jacoco.exec" />

	<property name="generator.sonar.projectKey" value="com.mirth.connect.generator" />
	<property name="generator.sonar.projectName" value="Generator" />
	<property name="generator.sonar.sources" value="src" />
	<property name="generator.sonar.java.binaries" value="." />
	<property name="generator.sonar.java.libraries" value="lib/*.jar" />
	<property name="generator.sonar.projectBaseDir" value="generator" />

	<property name="manager.sonar.projectKey" value="com.mirth.connect.manager" />
	<property name="manager.sonar.projectName" value="Manager" />
	<property name="manager.sonar.sources" value="src" />
	<property name="manager.sonar.java.binaries" value="classes" />
	<property name="manager.sonar.java.libraries" value="lib/*.jar" />
	<property name="manager.sonar.projectBaseDir" value="manager" />

	<property name="server.sonar.projectKey" value="com.mirth.connect.server" />
	<property name="server.sonar.projectName" value="Server" />
	<property name="server.sonar.sources" value="src" />
	<property name="server.sonar.tests" value="test" />
	<property name="server.sonar.java.binaries" value="classes" />
	<property name="server.sonar.java.libraries" value="lib/*.jar" />
	<property name="server.sonar.projectBaseDir" value="server" />
	<property name="server.sonar.junit.reportsPath" value="junit-reports" />
	<property name="server.sonar.jacoco.reportPath" value="code-coverage-reports/jacoco.exec" />

	<property name="simplesender.sonar.projectKey" value="com.mirth.connect.simplesender" />
	<property name="simplesender.sonar.projectName" value="SimpleSender" />
	<property name="simplesender.sonar.sources" value="src" />
	<property name="simplesender.sonar.java.binaries" value="." />
	<property name="simplesender.sonar.java.libraries" value="lib/*.jar" />
	<property name="simplesender.sonar.projectBaseDir" value="simplesender" />

	<property name="webadmin.sonar.projectKey" value="com.mirth.connect.webadmin" />
	<property name="webadmin.sonar.projectName" value="WebAdmin" />
	<property name="webadmin.sonar.sources" value="src" />
	<property name="webadmin.sonar.java.binaries" value="build/classes" />
	<property name="webadmin.sonar.projectBaseDir" value="webadmin" />

	<target name="sonar">
	    <taskdef uri="antlib:org.sonar.ant" resource="org/sonar/ant/antlib.xml">
	        <classpath path="server/lib/ant/sonarqube-ant-task-2.5.jar" />
	    </taskdef>
	 
	    <!-- Execute SonarQube Scanner for Ant Analysis -->
	    <sonar:sonar />
	</target>
</project>